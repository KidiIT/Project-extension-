exports.id=928,exports.ids=[928],exports.modules={9887:(t,e,s)=>{s.d(e,{HomeWebviewProvider:()=>HomeWebviewProvider});var i=s(1398),o=s(4293),n=s(7899),r=s(8973),a=s(3355);let h="home",g=new a.Q2(h,"section/collapse"),c=new a.C1(h,"repositories/didChange"),p=new a.C1(h,"subscription/didChange"),d=new a.C1(h,"org/settings/didChange"),l=Object.freeze({dispose:()=>{}});let HomeWebviewProvider=class HomeWebviewProvider{constructor(t,e){this.container=t,this.host=e,this._disposable=i.Disposable.from(this.container.git.onDidChangeRepositories(this.onRepositoriesChanged,this),i.workspace.isTrusted?l:i.workspace.onDidGrantWorkspaceTrust(this.notifyDidChangeRepositories,this),this.container.subscription.onDidChange(this.onSubscriptionChanged,this),(0,r.wt)(this.onContextChanged,this))}_disposable;dispose(){this._disposable.dispose()}onRepositoriesChanged(){this.notifyDidChangeRepositories()}registerCommands(){return[(0,n.Lb)(`${this.host.id}.refresh`,()=>this.host.refresh(!0),this)]}onMessageReceived(t){!0===g.is(t)&&this.onCollapseSection(t.params)}includeBootstrap(){return this.getState()}onReloaded(){this.notifyDidChangeRepositories()}onCollapseSection(t){let e=this.container.storage.get("home:sections:collapsed");if(null==e){!0===t.collapsed&&this.container.storage.store("home:sections:collapsed",[t.section]);return}let s=e.indexOf(t.section);if(!0===t.collapsed){-1===s&&this.container.storage.store("home:sections:collapsed",[...e,t.section]);return}-1!==s&&(e.splice(s,1),this.container.storage.store("home:sections:collapsed",e))}getWalkthroughCollapsed(){return this.container.storage.get("home:sections:collapsed")?.includes("walkthrough")??!1}getOrgSettings(){return{drafts:(0,r.SD)("gitlens:gk:organization:drafts:enabled",!1)}}onContextChanged(t){"gitlens:gk:organization:drafts:enabled"===t&&this.notifyDidChangeOrgSettings()}onSubscriptionChanged(t){this.notifyDidChangeSubscription(t.current)}async getState(t){return t??=await this.container.subscription.getSubscription(!0),{...this.host.baseWebviewState,repositories:this.getRepositoriesState(),webroot:this.host.getWebRoot(),promoStates:await this.getCanShowPromos(t),subscription:t,orgSettings:this.getOrgSettings(),walkthroughCollapsed:this.getWalkthroughCollapsed()}}getRepositoriesState(){return{count:this.container.git.repositoryCount,openCount:this.container.git.openRepositoryCount,hasUnsafe:this.container.git.hasUnsafeRepositories(),trusted:i.workspace.isTrusted}}async getCanShowPromos(t){let e={hs2023:!1,pro50:!1},s=t??await this.container.subscription.getSubscription(!0),i=new Date("2023-12-31T07:59:00.000Z").getTime();return Date.now()<i&&!(0,o.A_)(s)?e.hs2023=!0:null!=t&&((0,o.Mt)(t)||(0,o.Jc)(t))&&(e.pro50=!0),e}notifyDidChangeRepositories(){this.host.notify(c,this.getRepositoriesState())}async notifyDidChangeSubscription(t){t??=await this.container.subscription.getSubscription(!0),this.host.notify(p,{promoStates:await this.getCanShowPromos(t),subscription:t})}notifyDidChangeOrgSettings(){this.host.notify(d,{orgSettings:this.getOrgSettings()})}}}};