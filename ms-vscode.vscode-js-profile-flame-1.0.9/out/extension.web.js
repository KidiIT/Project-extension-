(()=>{var e,t,n,i,s,r,o,a,c,l,u,m,h,d={572:(e,t)=>{t.jz=function(){return"/tmp"}},115:e=>{"use strict";function t(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function n(e,t){for(var n,i="",s=0,r=-1,o=0,a=0;a<=e.length;++a){if(a<e.length)n=e.charCodeAt(a);else{if(47===n)break;n=47}if(47===n){if(r===a-1||1===o);else if(r!==a-1&&2===o){if(i.length<2||2!==s||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2))if(i.length>2){var c=i.lastIndexOf("/");if(c!==i.length-1){-1===c?(i="",s=0):s=(i=i.slice(0,c)).length-1-i.lastIndexOf("/"),r=a,o=0;continue}}else if(2===i.length||1===i.length){i="",s=0,r=a,o=0;continue}t&&(i.length>0?i+="/..":i="..",s=2)}else i.length>0?i+="/"+e.slice(r+1,a):i=e.slice(r+1,a),s=a-r-1;r=a,o=0}else 46===n&&-1!==o?++o:o=-1}return i}var i={resolve:function(){for(var e,i="",s=!1,r=arguments.length-1;r>=-1&&!s;r--){var o;r>=0?o=arguments[r]:(void 0===e&&(e=process.cwd()),o=e),t(o),0!==o.length&&(i=o+"/"+i,s=47===o.charCodeAt(0))}return i=n(i,!s),s?i.length>0?"/"+i:"/":i.length>0?i:"."},normalize:function(e){if(t(e),0===e.length)return".";var i=47===e.charCodeAt(0),s=47===e.charCodeAt(e.length-1);return 0!==(e=n(e,!i)).length||i||(e="."),e.length>0&&s&&(e+="/"),i?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,n=0;n<arguments.length;++n){var s=arguments[n];t(s),s.length>0&&(void 0===e?e=s:e+="/"+s)}return void 0===e?".":i.normalize(e)},relative:function(e,n){if(t(e),t(n),e===n)return"";if((e=i.resolve(e))===(n=i.resolve(n)))return"";for(var s=1;s<e.length&&47===e.charCodeAt(s);++s);for(var r=e.length,o=r-s,a=1;a<n.length&&47===n.charCodeAt(a);++a);for(var c=n.length-a,l=o<c?o:c,u=-1,m=0;m<=l;++m){if(m===l){if(c>l){if(47===n.charCodeAt(a+m))return n.slice(a+m+1);if(0===m)return n.slice(a+m)}else o>l&&(47===e.charCodeAt(s+m)?u=m:0===m&&(u=0));break}var h=e.charCodeAt(s+m);if(h!==n.charCodeAt(a+m))break;47===h&&(u=m)}var d="";for(m=s+u+1;m<=r;++m)m!==r&&47!==e.charCodeAt(m)||(0===d.length?d+="..":d+="/..");return d.length>0?d+n.slice(a+u):(a+=u,47===n.charCodeAt(a)&&++a,n.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var n=e.charCodeAt(0),i=47===n,s=-1,r=!0,o=e.length-1;o>=1;--o)if(47===(n=e.charCodeAt(o))){if(!r){s=o;break}}else r=!1;return-1===s?i?"/":".":i&&1===s?"//":e.slice(0,s)},basename:function(e,n){if(void 0!==n&&"string"!=typeof n)throw new TypeError('"ext" argument must be a string');t(e);var i,s=0,r=-1,o=!0;if(void 0!==n&&n.length>0&&n.length<=e.length){if(n.length===e.length&&n===e)return"";var a=n.length-1,c=-1;for(i=e.length-1;i>=0;--i){var l=e.charCodeAt(i);if(47===l){if(!o){s=i+1;break}}else-1===c&&(o=!1,c=i+1),a>=0&&(l===n.charCodeAt(a)?-1==--a&&(r=i):(a=-1,r=c))}return s===r?r=c:-1===r&&(r=e.length),e.slice(s,r)}for(i=e.length-1;i>=0;--i)if(47===e.charCodeAt(i)){if(!o){s=i+1;break}}else-1===r&&(o=!1,r=i+1);return-1===r?"":e.slice(s,r)},extname:function(e){t(e);for(var n=-1,i=0,s=-1,r=!0,o=0,a=e.length-1;a>=0;--a){var c=e.charCodeAt(a);if(47!==c)-1===s&&(r=!1,s=a+1),46===c?-1===n?n=a:1!==o&&(o=1):-1!==n&&(o=-1);else if(!r){i=a+1;break}}return-1===n||-1===s||0===o||1===o&&n===s-1&&n===i+1?"":e.slice(n,s)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var n=t.dir||t.root,i=t.base||(t.name||"")+(t.ext||"");return n?n===t.root?n+i:n+"/"+i:i}(0,e)},parse:function(e){t(e);var n={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return n;var i,s=e.charCodeAt(0),r=47===s;r?(n.root="/",i=1):i=0;for(var o=-1,a=0,c=-1,l=!0,u=e.length-1,m=0;u>=i;--u)if(47!==(s=e.charCodeAt(u)))-1===c&&(l=!1,c=u+1),46===s?-1===o?o=u:1!==m&&(m=1):-1!==o&&(m=-1);else if(!l){a=u+1;break}return-1===o||-1===c||0===m||1===m&&o===c-1&&o===a+1?-1!==c&&(n.base=n.name=0===a&&r?e.slice(1,c):e.slice(a,c)):(0===a&&r?(n.name=e.slice(1,o),n.base=e.slice(1,c)):(n.name=e.slice(a,o),n.base=e.slice(a,c)),n.ext=e.slice(o,c)),a>0?n.dir=e.slice(0,a-1):r&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};i.posix=i,e.exports=i},871:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>ye,deactivate:()=>xe});const i=require("vscode");function s(e=32){let t="";for(let n=0;n<e;n++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(62*Math.random())];return t}const r=e=>`<meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src 'unsafe-inline'; script-src 'nonce-${e}';">`,o=async(e,t)=>{const n=s();return`<!DOCTYPE html>\n    <html lang="en">\n    <head>\n      <meta charset="UTF-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      ${r(n)}\n      <title>Profile Custom Editor</title>\n    </head>\n    <body>\n      <script type="text/javascript" nonce="${n}">\n        ${Object.entries(t).map((([e,t])=>`globalThis.${e} = ${JSON.stringify(t)}`)).join(";")}\n      <\/script>\n      <script nonce="${n}" src="${e}"><\/script>\n    </body>\n    </html>\n  `};var a=n(572),c=n(115);class l{static{this.scheme="js-viz-download"}async provideTextDocumentContent(e){return i.window.withProgress({location:i.ProgressLocation.Notification,title:`Retrieving ${e.query}...`},(async()=>{try{const t=await fetch(e.query,{}),n=await t.text();return t.ok?n:`Unexpected ${t.status} from ${e.query}: ${n}`}catch(e){return e.message}}))}}function u(e,t){return c.posix?.isAbsolute(e)?c.posix.relative(e,t):c.win32?.isAbsolute(e)?c.win32.relative(e,t):c.relative(e,t)}let m="undefined"!=typeof process&&"win32"!==process.platform;function h(e){return m?e:e.toLowerCase()}function d(e){return e.startsWith("file:///")?(e=e.replace("file:///",""),"/"===(e=decodeURIComponent(e))[0]||e.match(/^[A-Za-z]:/)||(e="/"+e),p(e)&&(e=e[0].toLowerCase()+e.substr(1)),e):e}const p=e=>/^[A-Za-z]:/.test(e),f=async e=>{try{const t=y(e);return 0===t.type||await i.workspace.fs.stat(t.uri),!0}catch{return!1}},g=async({rootPath:e,location:t,viewColumn:n,callFrame:s})=>{t&&await v(e,t,n)||s&&await b(s,n)||i.window.showErrorMessage("Could not find the file in your workspace")},w=async(e,t,n,s)=>{const r=new i.Position(Math.max(0,t-1),Math.max(0,n-1));await i.window.showTextDocument(e,{viewColumn:s,selection:new i.Range(r,r)})},v=async(e,t,n)=>{const s=x(e,t.source),r=(await Promise.all(s.map(f))).findIndex((e=>e));if(-1===r)return!1;const o=y(s[r]);if(0===o.type)return await(a=o,i.commands.executeCommand(a.command,...a.args)),!0;var a;const c=await i.workspace.openTextDocument(o.uri);return await w(c,t.lineNumber,t.columnNumber,n),!0},b=async({url:e,lineNumber:t,columnNumber:n},s)=>{let r;try{r=new URL(e)}catch{return!1}if("http:"!==r.protocol&&"https:"!==r.protocol)return!1;const o=(0,c.resolve)(i.workspace.workspaceFolders?.[0].uri.fsPath??(0,a.jz)(),r.pathname.slice(1)||"index.js"),u=await i.workspace.openTextDocument(i.Uri.file(o).with({scheme:l.scheme,query:e}));return await w(u,t+1,n+1,s),!0},y=e=>{const t=e?.match(/^command:([\w\.]+)(?:\?(.*))?/);if(t){const[e,n]=t.slice(1),i=n?JSON.parse(decodeURIComponent(n)):[];return{type:0,command:e,args:Array.isArray(i)?i:[i]}}return e?.match(/\w\w+:/)?{type:1,uri:i.Uri.parse(e||""),isFile:!1}:{type:1,uri:i.Uri.file(e||""),isFile:!0}},x=(e,t)=>{if(!t.path)return[];const n=y(t.path),s=[t.path];if(!e||0===n.type||!n.isFile)return s;for(const n of i.workspace.workspaceFolders??[])s.push((0,c.resolve)(n.uri.fsPath,u(e,t.path)));return s};class S{constructor(e,t){this.uri=e,this.userData=t}dispose(){}}function C(e,t){if(!C||i.extensions.all.some((t=>t.id===e)))return t();i.commands.executeCommand("workbench.extensions.action.showExtensionsWithIds",[C])}function D(e,t,n,s){return C(n,(()=>i.commands.executeCommand("vscode.openWith",e,t,s?i.ViewColumn.Beside:i.ViewColumn.Active)))}const M=Symbol("unset"),T=/[^/\\]+$/,k=e=>T.exec(e)?.[0]??e;class P{constructor(){this.basenamesToExpand=new Map}add(e,t){const n=(e=>{let t=M;return()=>(t===M&&(t=e()),t)})((()=>{const n=new Set,s=new i.Position(Math.max(0,t.callFrame.lineNumber),Math.max(0,t.callFrame.columnNumber));n.add(`${t.callFrame.url}/${s.line}`),this.set(t.callFrame.url,s,t);const r=t.src;if(r&&0===r.source.sourceReference&&r.source.path&&r.source.path!==t.callFrame.url)for(const s of x(e,r.source)){const e=new i.Position(Math.max(0,r.lineNumber-1),Math.max(0,r.columnNumber-1)),o=`${s}/${e.line}`;n.has(o)||(n.add(o),this.set(s,e,t))}}));this.addExpansionFn(k(t.callFrame.url),n),t.src?.source.path&&this.addExpansionFn(k(t.src.source.path),n)}addExpansionFn(e,t){let n=this.basenamesToExpand.get(e);n||(n=[],this.basenamesToExpand.set(e,n)),n.push(t)}expandForFile(e){const t=k(e),n=this.basenamesToExpand.get(t);if(n){for(const e of n)e();this.basenamesToExpand.delete(t)}}}const F=new Intl.NumberFormat(void 0,{maximumFractionDigits:2,minimumFractionDigits:2});class _ extends P{constructor(){super(...arguments),this.data=new Map}set(e,t,n){let s=this.data.get(h(e));s||(s=[],this.data.set(h(e),s));let r=0;for(;r<s.length&&s[r].position.line<t.line;)r++;if(s[r]?.position.line===t.line){const e=s[r];t.character<e.position.character&&(e.position=new i.Position(t.line,t.character)),e.data.aggregateTime+=n.aggregateTime,e.data.selfTime+=n.selfTime,e.data.ticks+=n.ticks}else s.splice(r,0,{position:new i.Position(t.line,t.character),data:{aggregateTime:n.aggregateTime,selfTime:n.selfTime,ticks:n.ticks}})}getLensesForFile(e){return this.expandForFile(e),this.data.get(h(e))?.map((({position:e,data:t})=>{if(0===t.aggregateTime&&0===t.selfTime)return[];const n=new i.Range(e,e);return[new i.CodeLens(n,{title:`${F.format(t.selfTime/1e3)}ms Self Time, ${F.format(t.aggregateTime/1e3)}ms Total`,command:""}),new i.CodeLens(n,{title:"Clear",command:"extension.jsProfileVisualizer.table.clearCodeLenses"})]})).reduce(((e,t)=>[...e,...t]),[])??[]}}const z=(e,t)=>(e.functionName=e.functionName||"(anonymous)",e.lineNumber<0?0:e.url.includes("node_modules")||!t?2:1),N=(e,t)=>t.source.path&&0===t.source.sourceReference?{...t,relativePath:u(e,t.source.path)}:t,E=(e,t=[])=>{if(!e.$vscode?.rootPath)return t[0];for(const n of t){const t=N(e.$vscode.rootPath,n);if(t.relativePath)return t}return t[0]},A=(e,t)=>{const n=t[e];if(n.aggregateTime)return n.aggregateTime;let i=n.selfTime;for(const e of n.children)i+=A(e,t);return n.aggregateTime=i};class j{constructor(e,t,n={}){this.lens=e,this.bundle=t,this.extraConsts=n,this.onDidChangeCustomDocument=(new i.EventEmitter).event}async openCustomDocument(e){const t=await i.workspace.fs.readFile(e),n=JSON.parse((new TextDecoder).decode(t)),s=new S(e,(e=>{if(!e.timeDeltas||!e.samples)return{nodes:[],locations:[],samples:e.samples||[],timeDeltas:e.timeDeltas||[],rootPath:e.$vscode?.rootPath,duration:e.endTime-e.startTime};const{samples:t,timeDeltas:n}=e,i=(e=>{if(e.$vscode)return e.$vscode.locations;let t=0;const n=new Map,i=e=>{const i=[e.functionName,e.url,e.scriptId,e.lineNumber,e.columnNumber].join(":"),s=n.get(i);if(s)return s.id;const r=t++;return n.set(i,{id:r,callFrame:e,location:{lineNumber:e.lineNumber+1,columnNumber:e.columnNumber+1,source:{name:d(e.url),path:d(e.url),sourceReference:0}}}),r};for(const t of e.nodes)t.locationId=i(t.callFrame),t.positionTicks=t.positionTicks?.map((e=>({...e,startLocationId:i({...t.callFrame,lineNumber:e.line-1,columnNumber:0}),endLocationId:i({...t.callFrame,lineNumber:e.line,columnNumber:0})})));return[...n.values()].sort(((e,t)=>e.id-t.id)).map((e=>({locations:[e.location],callFrame:e.callFrame})))})(e).map(((t,n)=>{const i=E(e,t.locations);return{id:n,selfTime:0,aggregateTime:0,ticks:0,category:z(t.callFrame,i),callFrame:t.callFrame,src:i}})),s=new Map,r=e=>{let t=s.get(e);return void 0===t&&(t=s.size,s.set(e,t)),t},o=new Array(e.nodes.length);for(let t=0;t<e.nodes.length;t++){const n=e.nodes[t],s=r(n.id);o[s]={id:s,selfTime:0,aggregateTime:0,locationId:n.locationId,children:n.children?.map(r)||[]};for(const e of n.positionTicks||[])e.startLocationId&&(i[e.startLocationId].ticks+=e.ticks)}for(const e of o)for(const t of e.children)o[t].parent=e.id;const a=e.endTime-e.startTime;let c=a-n[0];for(let e=0;e<n.length-1;e++){const i=n[e+1];o[r(t[e])].selfTime+=i,c-=i}o.length&&(o[r(t[n.length-1])].selfTime+=c,n.push(c));for(let e=0;e<o.length;e++){const t=o[e],n=i[t.locationId];n.aggregateTime+=A(e,o),n.selfTime+=t.selfTime}return{nodes:o,locations:i,samples:t.map(r),timeDeltas:n,rootPath:e.$vscode?.rootPath,duration:a}})(n)),r=new _,o=s.userData.rootPath;for(const e of s.userData.locations)r.add(o,e);return this.lens.registerLenses(r),s}async resolveCustomEditor(e,t){t.webview.onDidReceiveMessage((t=>{switch(t.type){case"openDocument":return void g({rootPath:e.userData?.rootPath,viewColumn:t.toSide?i.ViewColumn.Beside:i.ViewColumn.Active,callFrame:t.callFrame,location:t.location});case"reopenWith":return void D(e.uri,t.viewType,t.requireExtension);default:console.warn(`Unknown request from webview: ${JSON.stringify(t)}`)}})),t.webview.options={enableScripts:!0},t.webview.html=await o(t.webview.asWebviewUri(this.bundle),{MODEL:e.userData,...this.extraConsts})}async saveCustomDocument(){}async revertCustomDocument(){}async backupCustomDocument(){return{id:"",delete:()=>{}}}saveCustomDocumentAs(e,t){return i.workspace.fs.copy(e.uri,t,{overwrite:!0})}}function $(e,t){if(!$||i.extensions.all.some((t=>t.id===e)))return t();i.commands.executeCommand("workbench.extensions.action.showExtensionsWithIds",[$])}const U=(e,t)=>t.method===e,I=(e,t)=>{const n=new Array(e.length);for(let i=0;i<e.length;i++){const s=e[i];n[i]=t(s,i),s.free()}return n},R=e=>I(e,(e=>({name:e.name(),childrenLen:e.children_len,id:e.id,index:e.index,retainedSize:Number(e.retained_size),selfSize:Number(e.self_size),type:e.typ,retainsIndex:e.retains_index,edgeType:e.edge_typ}))),O=async()=>{const{decode_bytes:e,init_panic_hook:t}=await n.e(848).then(n.bind(n,848));return t(),e},L=globalThis.__jsHeapSnapshotWorkers??=new class{constructor(){this.workers=new Map}async create(e){let t=this.workers.get(e.with({query:""}).toString());if(!t){const n=await(async e=>{const t=new i.EventEmitter,n=Promise.all([i.workspace.fs.readFile(e),O()]).then((([e,t])=>t(e)));return{postMessage:e=>((e,t)=>e.then((e=>{if(U("getClassGroups",t))return I(e.get_class_groups(...t.args,!1),((e,t)=>({name:e.name(),index:t,retainedSize:Number(e.retained_size),selfSize:Number(e.self_size),childrenLen:e.children_len})));if(U("getClassChildren",t))return R(e.class_children(...t.args));if(U("getNodeChildren",t))return R(e.node_children(...t.args));if(U("getRetainers",t))return R(e.get_all_retainers(...t.args));throw new Error(`unknown method ${t.method}`)})).then((e=>({id:t.id,result:{ok:e}}))).catch((e=>({id:t.id,result:{err:e.stack||e.message||String(e)}}))))(n,e).then((e=>t.fire(e))),onMessage:t.event,terminate:()=>n.then((e=>e.free()))}})(e);t={worker:n,rc:0},this.workers.set(e.toString(),t)}return t.rc++,t.closer&&(clearTimeout(t.closer),t.closer=void 0),{worker:t.worker,dispose:()=>{--t.rc||(t.closer=setTimeout((()=>{t.worker.terminate(),this.workers.delete(e.toString())}),5e3))}}}},W=e=>L.create(e),V=async({worker:e},t,n,s,r)=>{s.onDidReceiveMessage((t=>{switch(t.type){case"reopenWith":return void function(e,t,n,s){$(n,(()=>i.commands.executeCommand("vscode.openWith",e,t,s?i.ViewColumn.Beside:i.ViewColumn.Active)))}(n.with({query:t.withQuery}),t.viewType,t.requireExtension,t.toSide);case"command":return void $(t.requireExtension,(()=>i.commands.executeCommand(t.command,...t.args)));case"callGraph":return void e.postMessage(t.inner);default:console.warn(`Unknown request from webview: ${JSON.stringify(t)}`)}}));const o=e.onMessage((e=>{s.postMessage({method:"graphRet",message:e})}));return s.options={enableScripts:!0},s.html=await(async(e,t)=>{const n=function(e=32){let t="";for(let n=0;n<e;n++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(62*Math.random())];return t}();return`<!DOCTYPE html>\n    <html lang="en">\n    <head>\n      <meta charset="UTF-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      ${(e=>`<meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src 'unsafe-inline'; script-src 'nonce-${e}';">`)(n)}\n      <title>Profile Custom Editor</title>\n    </head>\n    <body>\n      <script type="text/javascript" nonce="${n}">\n        ${Object.entries(t).map((([e,t])=>`globalThis.${e} = ${JSON.stringify(t)}`)).join(";")}\n      <\/script>\n      <script nonce="${n}" src="${e}"><\/script>\n    </body>\n    </html>\n  `})(s.asWebviewUri(t),{SNAPSHOT_URI:s.asWebviewUri(n).toString(),DOCUMENT_URI:n.toString(),...r}),o},q=new Intl.NumberFormat(void 0,{maximumFractionDigits:0,minimumFractionDigits:0});class B extends P{constructor(){super(...arguments),this.data=new Map}set(e,t,n){let s=this.data.get(h(e));s||(s=[],this.data.set(h(e),s));let r=0;for(;r<s.length&&s[r].position.line<t.line;)r++;if(s[r]?.position.line===t.line){const e=s[r];t.character<e.position.character&&(e.position=new i.Position(t.line,t.character)),e.data.totalSize+=n.totalSize,e.data.selfSize+=n.selfSize}else s.splice(r,0,{position:new i.Position(t.line,t.character),data:{totalSize:n.totalSize,selfSize:n.selfSize}})}getLensesForFile(e){return this.expandForFile(e),this.data.get(h(e))?.map((({position:e,data:t})=>{if(0===t.totalSize&&0===t.selfSize)return[];const n=new i.Range(e,e);return[new i.CodeLens(n,{title:`${q.format(t.selfSize/1e3)}kB Self Size, ${q.format(t.totalSize/1e3)}kB Total Size`,command:""}),new i.CodeLens(n,{title:"Clear",command:"extension.jsProfileVisualizer.table.clearCodeLenses"})]})).reduce(((e,t)=>[...e,...t]),[])??[]}}class H{static root(){return new H({id:-1,selfSize:0,children:[],callFrame:{functionName:"(root)",lineNumber:-1,columnNumber:-1,scriptId:"0",url:""}})}get id(){return this.node.id}get callFrame(){return this.node.callFrame}get src(){return this.node.src}constructor(e,t){this.node=e,this.parent=t,this.children={},this.totalSize=0,this.selfSize=0,this.childrenSize=0,this.category=z(e.callFrame,void 0)}toJSON(){return{category:this.category,children:this.children,childrenSize:this.childrenSize,selfSize:this.selfSize,totalSize:this.totalSize,id:this.id,callFrame:this.callFrame,src:this.src}}}const J=(e,t)=>{const n=new H(e,t);e.children.forEach((e=>{const t=J(e,n);n.children[t.id]=t,n.childrenSize++})),n.selfSize=e.selfSize,n.totalSize=e.selfSize;for(const e in n.children)n.totalSize+=n.children[e].totalSize;return n};class G{constructor(e,t,n={}){this.lens=e,this.bundle=t,this.extraConsts=n,this.onDidChangeCustomDocument=(new i.EventEmitter).event}async openCustomDocument(e){const t=await i.workspace.fs.readFile(e),n=JSON.parse((new TextDecoder).decode(t)),s=new S(e,(e=>{let t=[e.head];const n=(e=>{if(e.$vscode)return e.$vscode.locations;let t=0;const n=new Map,i=e=>{const i=[e.functionName,e.url,e.scriptId,e.lineNumber,e.columnNumber].join(":"),s=n.get(i);if(s)return s.id;const r=t++;return n.set(i,{id:r,callFrame:e,location:{lineNumber:e.lineNumber+1,columnNumber:e.columnNumber+1,source:{name:d(e.url),path:d(e.url),sourceReference:0}}}),r};let s=[e.head];for(;s.length;){const e=s.pop();if(e){const{callFrame:t}=e;e.locationId=i(t),s=s.concat(e.children)}}return[...n.values()].sort(((e,t)=>e.id-t.id)).map((e=>({locations:[e.location],callFrame:e.callFrame})))})(e);for(;t.length;){const i=t.pop();i&&(i.locationId&&(i.src=E(e,n[i.locationId].locations)),t=t.concat(i.children))}return{head:e.head,samples:e.samples,rootPath:e.$vscode?.rootPath}})(n)),r=(e=>{const t=H.root();for(const n of e.head.children){const e=J(n,t);t.children[e.id]=e,t.childrenSize++}for(const e in t.children)t.totalSize+=t.children[e].totalSize;return t})(s.userData),o=[r];let a=[r];for(;a.length;){const e=a.pop();e&&(o.push(e),a=a.concat(Object.values(e.children)))}const c=new B,l=s.userData.rootPath;for(const e of o)c.add(l,e);return this.lens.registerLenses(c),s}async resolveCustomEditor(e,t){t.webview.onDidReceiveMessage((t=>{switch(t.type){case"openDocument":return void g({rootPath:void 0,viewColumn:t.toSide?i.ViewColumn.Beside:i.ViewColumn.Active,callFrame:t.callFrame,location:t.location});case"reopenWith":return void D(e.uri,t.viewType,t.requireExtension);default:console.warn(`Unknown request from webview: ${JSON.stringify(t)}`)}})),t.webview.options={enableScripts:!0},t.webview.html=await o(t.webview.asWebviewUri(this.bundle),{MODEL:e.userData,...this.extraConsts})}async saveCustomDocument(){}async revertCustomDocument(){}async backupCustomDocument(){return{id:"",delete:()=>{}}}saveCustomDocumentAs(e,t){return i.workspace.fs.copy(e.uri,t,{overwrite:!0})}}class Y{constructor(){this.changeEmitter=new i.EventEmitter,this.onDidChangeCodeLenses=this.changeEmitter.event}registerLenses(e){return i.commands.executeCommand("setContext","jsProfileVisualizer.hasCodeLenses",!0),this.lenses=e,{dispose:()=>{this.lenses===e&&this.clear()}}}clear(){this.lenses&&(this.lenses=void 0,i.commands.executeCommand("setContext","jsProfileVisualizer.hasCodeLenses",!1),this.changeEmitter.fire())}provideCodeLenses(e){const t=this.lenses?.getLensesForFile(h(e.uri.fsPath));if(t)return t;return(e.uri.scheme===l.scheme?this.lenses?.getLensesForFile(e.uri.query):void 0)||[]}}class Q{constructor(){this.innerMetrics=[],this.width=1,this.maxMetric=1,this.lastIncrements=500,this.index=0}get maxY(){let e=10**Math.ceil(Math.log10(this.maxMetric));return e>2*this.maxMetric&&(e/=2),e>2*this.maxMetric&&(e/=2),e}valueAt(e){return this.innerMetrics[this.innerMetrics.length-(this.index-e)-1]}get metrics(){return this.innerMetrics}get current(){return this.innerMetrics[this.innerMetrics.length-1]??0}reset(e,t){const n=Math.ceil(e/t)+3;this.width=n,t!==this.lastIncrements?(this.maxMetric=1,this.index=0,this.innerMetrics=[],this.lastIncrements=t):this.width>this.innerMetrics.length&&(this.innerMetrics=this.innerMetrics.slice(-this.width))}hasData(){return!!this.innerMetrics.length}setData(e){this.innerMetrics=e,this.index=e.length,this.maxMetric=this.recalcMax()}push(e,t){this.innerMetrics.length===this.width&&this.innerMetrics.shift()===this.maxMetric&&t<this.maxMetric&&(this.maxMetric=this.recalcMax()),this.maxMetric=Math.max(this.maxMetric,t),this.innerMetrics.push(t),this.index++}recalcMax(){let e=1;for(const t of this.innerMetrics)e=Math.max(e,t);return e}}class K extends Q{constructor(){super(...arguments),this.lastTimeStamp=-1,this.lastMetric=-1}setData(e){super.setData(e),this.lastTimeStamp=-1}push(e,t){const n=this.lastTimeStamp,i=this.lastMetric;this.lastTimeStamp=e,this.lastMetric=t,-1!==this.lastTimeStamp&&super.push(e,(t-i)/(e-n)*1e3)}}const X=["B","KB","MB","GB","TB"],Z=new Intl.NumberFormat(void 0,{maximumSignificantDigits:3}),ee=new Intl.NumberFormat(void 0,{notation:"compact"}),te=e=>{let t=0;for(;e>1024&&t<X.length;)e/=1024,t++;return`${Z.format(e)} ${X[t]}`},ne=new Intl.NumberFormat(void 0,{style:"percent",minimumSignificantDigits:2,maximumSignificantDigits:2}),ie=new Intl.NumberFormat(void 0,{style:"percent",maximumFractionDigits:2});new Intl.NumberFormat(void 0,{maximumFractionDigits:1});class se extends K{update(e,t){t.cpu?this.push(e,t.cpu.user/1e3/1e3):void 0!==t.TaskDuration&&this.push(e,t.TaskDuration/1e3)}format(e){return(e=Math.max(0,Math.min(1,e)))>=.01?ne.format(e):ie.format(e)}name(){return"CPU Usage"}short(){return"CPU"}recalcMax(){return 1}}class re extends Q{update(e,t){t.memory?this.push(e,t.memory.heapUsed):void 0!==t.JSHeapUsedSize&&this.push(e,t.JSHeapUsedSize)}format(e){return te(e)}short(){return"Heap"}name(){return"Heap Used"}}class oe extends Q{update(e,t){t.memory&&this.push(e,t.memory.heapTotal)}format(e){return te(e)}short(){return"Heap Total"}name(){return"Heap Total"}}class ae extends Q{update(e,t){t.memory&&this.push(e,t.memory.rss)}format(e){return te(e)}short(){return"RSS"}name(){return"Resident Set Size"}}class ce extends Q{update(e,t){t.memory&&this.push(e,t.memory.external)}format(e){return te(e)}short(){return"External"}name(){return"External Memory"}}class le extends Q{update(e,t){t.memory&&this.push(e,t.memory.arrayBuffers)}format(e){return te(e)}short(){return"ArrayBuffer"}name(){return"ArrayBuffer Memory"}}class ue extends Q{update(e,t){t.Nodes&&this.push(e,t.Nodes)}format(e){return ee.format(e)}short(){return"DOM Nodes"}name(){return"DOM Nodes"}}class me extends K{update(e,t){void 0!==t.LayoutCount&&this.push(e,t.LayoutCount/1e3)}format(e){return ee.format(e)}short(){return"Relayouts"}name(){return"DOM Relayouts / s"}}class he extends K{update(e,t){void 0!==t.RecalcStyleCount&&this.push(e,t.RecalcStyleCount/1e3)}format(e){return ee.format(e)}short(){return"Restyles"}name(){return"Style Recalcs / s"}}const de=()=>[new se,new re,new oe,new ae,new ce,new le,new ue,new me,new he],pe=e=>{const t=i.workspace.getConfiguration();return{easing:t.get("debug.flameGraph.realtimeEasing")??i.window.activeColorTheme.kind!==i.ColorThemeKind.HighContrast,enabledMetrics:e.workspaceState.get(fe)??[0,1],splitCharts:e.workspaceState.get(ge)??!1,pollInterval:1e3*t.get("debug.flameGraph.realtimePollInterval",1),viewDuration:1e3*t.get("debug.flameGraph.realtimeViewDuration",30),zoomLevel:t.get("window.zoomLevel",0)}},fe="enabledMetrics",ge="splitCharts";class we{get visibleWebviews(){return[...this.webviews].filter((e=>e.visible))}get currentData(){return this.displayedSession&&this.sessionData.get(this.displayedSession)?.metrics}constructor(e){this.context=e,this.settings=pe(this.context),this.webviews=new Set,this.sessionData=new Map,this.allSessions=new Map,i.commands.executeCommand("setContext","vscodeJsProfileFlameSplitCharts",pe(e).splitCharts)}setEnabledMetrics(e){this.context.workspaceState.update(fe,e),this.updateSettings()}setSplitCharts(e){i.commands.executeCommand("setContext","vscodeJsProfileFlameSplitCharts",e),this.context.workspaceState.update(ge,e),this.updateSettings()}trackWebview(e){this.webviews.add(e),e.onDidChangeVisibility((()=>{e.visible&&this.hydrate(e.webview)})),e.onDidDispose((()=>{this.webviews.delete(e)})),this.hydrate(e.webview)}onDidChangeActiveSession(e){for(;e?.configuration.__usePerformanceFromParent;)e=this.allSessions.get(e.configuration.__parentId);if(!this.visibleWebviews.length||!e||!("__pendingTargetId"in e.configuration))return;let t=this.sessionData.get(e);if(!t){t={session:e,metrics:de(),cts:new i.CancellationTokenSource};for(const e of t.metrics)e.reset(this.settings.viewDuration,this.settings.pollInterval);this.collectFromSession(t),this.sessionData.set(e,t)}this.displayedSession=e,this.broadcast({type:4,data:t.metrics.map((e=>e.metrics))})}onSessionDidStart(e){this.allSessions.set(e.id,e)}onSessionDidEnd(e){this.allSessions.delete(e.id);const t=this.sessionData.get(e);t&&(t.cts.cancel(),this.sessionData.delete(e),this.displayedSession===e&&(this.displayedSession=void 0,this.broadcast({type:5})))}updateSettings(){this.settings=pe(this.context);for(const{metrics:e}of this.sessionData.values())for(const t of e)t.reset(this.settings.viewDuration,this.settings.pollInterval);this.broadcast({type:0,settings:this.settings})}collectFromSession(e){const t=()=>{e.session.customRequest("getPerformance").then((n=>{if(e.cts.token.isCancellationRequested)return;n.metrics&&(n.metrics.timestamp=n.metrics.timestamp||n.metrics.Timestamp||Date.now(),this.onMetrics(e,n.metrics));const i=setTimeout((()=>{s.dispose(),t()}),this.settings.pollInterval),s=e.cts.token.onCancellationRequested((()=>{clearTimeout(i)}))}))};t()}onMetrics({session:e,metrics:t},n){for(const e of t)e.update(n.timestamp,n);e===this.displayedSession&&this.broadcast({type:1,data:n})}broadcast(e){for(const t of this.visibleWebviews)t.webview.postMessage(e)}hydrate(e){e.postMessage(this.getSettingsUpdate());const t=this.displayedSession&&this.sessionData.get(this.displayedSession);if(t){const n={type:4,data:t.metrics.map((e=>e.metrics))};e.postMessage(n)}else this.onDidChangeActiveSession(i.debug.activeDebugSession)}getSettingsUpdate(){return{type:0,settings:pe(this.context)}}}class ve{static{this.viewType="vscode-js-profile-flame.realtime"}constructor(e,t){this.extensionUri=e,this.tracker=t}resolveWebviewView(e){e.webview.options={enableScripts:!0,localResourceRoots:[this.extensionUri]},e.webview.html=this.getHtmlForWebview(e.webview),this.tracker.trackWebview(e),e.webview.onDidReceiveMessage((e=>{3===e.type&&this.tracker.setEnabledMetrics(e.keys)}))}getHtmlForWebview(e){const t=e.asWebviewUri(i.Uri.joinPath(this.extensionUri,"out","realtime.bundle.js")),n=s();return`<!DOCTYPE html>\n\t\t\t<html lang="en">\n\t\t\t<head>\n\t\t\t\t<meta charset="UTF-8">\n        ${r(n)}\n\t\t\t\t<meta name="viewport" content="width=device-width, initial-scale=1.0">\n\t\t\t\t<title>Realtime Performance</title>\n\t\t\t</head>\n      <body>\n\t\t\t\t<script nonce="${n}" src="${t}"><\/script>\n\t\t\t</body>\n      </html>\n    `}}const be=["debug.flameGraph.realtimePollInterval","debug.flameGraph.realtimeViewDuration","debug.flameGraph.realtimeEasing"];function ye(e){const t=new we(e),n=new ve(e.extensionUri,t);e.subscriptions.push(i.window.registerCustomEditorProvider("jsProfileVisualizer.cpuprofile.flame",new j(new Y,i.Uri.joinPath(e.extensionUri,"out","cpu-client.bundle.js")),{webviewOptions:{retainContextWhenHidden:!0}}),i.window.registerCustomEditorProvider("jsProfileVisualizer.heapprofile.flame",new G(new Y,i.Uri.joinPath(e.extensionUri,"out","heap-client.bundle.js")),{webviewOptions:{retainContextWhenHidden:!0}}),i.commands.registerCommand("jsProfileVisualizer.heapsnapshot.flame.show",(async({uri:t,index:n,name:s})=>{const r=i.window.createWebviewPanel("jsProfileVisualizer.heapsnapshot.flame",i.l10n.t("Memory Graph: {0}",s),i.ViewColumn.Beside,{enableScripts:!0,localResourceRoots:[i.Uri.joinPath(e.extensionUri,"out")]}),o=i.Uri.parse(t),a=await W(o),c=await V(a,i.Uri.joinPath(e.extensionUri,"out","heapsnapshot-client.bundle.js"),o,r.webview,{SNAPSHOT_INDEX:n});r.onDidDispose((()=>{a.dispose(),c.dispose()}))})),i.window.registerWebviewPanelSerializer("jsProfileVisualizer.heapsnapshot.flame.show",{deserializeWebviewPanel:()=>Promise.resolve()}),i.window.registerWebviewViewProvider(ve.viewType,n),i.workspace.onDidChangeConfiguration((e=>{be.some((t=>e.affectsConfiguration(t)))&&t.updateSettings()})),i.debug.onDidChangeActiveDebugSession((e=>t.onDidChangeActiveSession(e))),i.debug.onDidStartDebugSession((e=>t.onSessionDidStart(e))),i.debug.onDidTerminateDebugSession((e=>t.onSessionDidEnd(e))),i.commands.registerCommand("vscode-js-profile-flame.setRealtimeCharts",(async()=>{const n=de(),s=pe(e),r=i.window.createQuickPick();r.title="Toggle visible performance charts",r.canSelectMany=!0,r.items=(t.currentData?.filter((e=>e.hasData()))??n).map(((e,t)=>({label:e.name(),index:t}))),r.selectedItems=s.enabledMetrics.length?s.enabledMetrics.map((e=>r.items[e])):r.items.slice(),r.show();const o=await new Promise((e=>{r.onDidAccept((()=>e(r.selectedItems.map((e=>e.index))))),r.onDidHide((()=>e(void 0)))}));r.dispose(),o&&t.setEnabledMetrics(o)})),i.commands.registerCommand("vscode-js-profile-flame.splitCharts",(()=>{t.setSplitCharts(!0)})),i.commands.registerCommand("vscode-js-profile-flame.collapseCharts",(()=>{t.setSplitCharts(!1)})))}function xe(){}}},p={};function f(e){var t=p[e];if(void 0!==t)return t.exports;var n=p[e]={id:e,loaded:!1,exports:{}};return d[e](n,n.exports,f),n.loaded=!0,n.exports}f.m=d,f.c=p,f.d=(e,t)=>{for(var n in t)f.o(t,n)&&!f.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},f.f={},f.e=e=>Promise.all(Object.keys(f.f).reduce(((t,n)=>(f.f[n](e,t),t)),[])),f.u=e=>e+".extension.web.js",f.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),f.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),f.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),f.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;f.g.importScripts&&(e=f.g.location+"");var t=f.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=n[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),f.p=e})(),(()=>{var e={792:1};f.f.i=(t,n)=>{e[t]||importScripts(f.p+f.u(t))};var t=self.webpackChunkvscode_js_profile_flame=self.webpackChunkvscode_js_profile_flame||[],n=t.push.bind(t);t.push=t=>{var[i,s,r]=t;for(var o in s)f.o(s,o)&&(f.m[o]=s[o]);for(r&&r(f);i.length;)e[i.pop()]=1;n(t)}})(),u={},m={16:function(){return{"./v8_heap_parser_bg.js":{__wbindgen_string_new:function(t,n){return void 0===e&&(e=f.c[4].exports),e.yc(t,n)},__wbindgen_object_drop_ref:function(e){return void 0===t&&(t=f.c[4].exports),t.bk(e)},__wbg_classgroup_new:function(e){return void 0===n&&(n=f.c[4].exports),n.Mq(e)},__wbg_node_new:function(e){return void 0===i&&(i=f.c[4].exports),i.Rs(e)},__wbg_retainernode_new:function(e){return void 0===s&&(s=f.c[4].exports),s.bU(e)},__wbg_new_abda76e883ba8a5f:function(){return void 0===r&&(r=f.c[4].exports),r.V5()},__wbg_stack_658279fe44541cf6:function(e,t){return void 0===o&&(o=f.c[4].exports),o.u$(e,t)},__wbg_error_f851667af71bcfc6:function(e,t){return void 0===a&&(a=f.c[4].exports),a.Xu(e,t)},__wbindgen_throw:function(e,t){return void 0===c&&(c=f.c[4].exports),c.Qn(e,t)},__wbindgen_string_get:function(e,t){return void 0===l&&(l=f.c[4].exports),l.qN(e,t)}}}}},h={848:[16]},f.w={},f.f.wasm=function(e,t){(h[e]||[]).forEach((function(n,i){var s=u[n];if(s)t.push(s);else{var r,o=m[n](),a=fetch(f.p+""+{848:{16:"dbd61d846b1102299709"}}[e][n]+".module.wasm");r=o&&"function"==typeof o.then&&"function"==typeof WebAssembly.compileStreaming?Promise.all([WebAssembly.compileStreaming(a),o]).then((function(e){return WebAssembly.instantiate(e[0],e[1])})):"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,o):a.then((function(e){return e.arrayBuffer()})).then((function(e){return WebAssembly.instantiate(e,o)})),t.push(u[n]=r.then((function(e){return f.w[n]=(e.instance||e).exports})))}}))};var g=f(871);module.exports=g})();